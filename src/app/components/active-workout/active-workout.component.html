<div class="active-workout-container">
  <!-- Header with workout timer -->
  <div class="workout-header">
    <button class="btn btn-icon" (click)="goBack()" title="Go back">
      <app-svg-icon name="arrow_back" size="lg"></app-svg-icon>
    </button>

    @if (workoutTemplate(); as template) {
      <div class="header-info">
        <h1 class="workout-name">{{ template.name }}</h1>
        <div class="workout-timer">{{ formatTime(elapsedTime()) }}</div>
      </div>
    }
  </div>

  <!-- Pre-Workout State -->
  @if (!isWorkoutActive()) {
    <div class="pre-workout">
      @if (workoutTemplate(); as template) {
        <div class="workout-preview">
          <h2>Ready to start?</h2>
          <div class="exercise-list">
            @for (exercise of template.exercises; track exercise.id; let i = $index) {
              <div class="exercise-preview-item">
                <div class="exercise-number">{{ i + 1 }}</div>
                <div class="exercise-info">
                  <div class="exercise-name">{{ exercise.name }}</div>
                  <div class="exercise-details">
                    {{ exercise.sets }}×{{ exercise.reps || exercise.duration + 's' }}
                    @if (exercise.weight) {
                      {{ exercise.weight }}lb
                    }
                  </div>
                </div>
              </div>
            }
          </div>
          <button class="btn btn-primary start-button" (click)="startWorkout()">
            <app-svg-icon name="play" size="md"></app-svg-icon>
            Start Workout
          </button>
        </div>
      }
    </div>
  }

  <!-- Active Workout State -->
  @if (isWorkoutActive() && !isWorkoutComplete()) {
    <div class="active-workout-content">
      <!-- Exercise List with Set Circles -->
      @if (workoutTemplate(); as template) {
        <div class="exercises-list">
          @for (exercise of template.exercises; track exercise.id; let exerciseIndex = $index) {
            <div class="exercise-card"
                 [class.current]="currentExerciseIndex() === exerciseIndex">
              <div class="exercise-header">
                <div class="exercise-title">
                  <div class="exercise-name">{{ exercise.name }}</div>
                  <div class="exercise-target">
                    {{ exercise.sets }}×{{ exercise.reps || (exercise.duration + 's') }}
                    @if (exercise.weight) {
                      {{ exercise.weight }}lb
                    }
                  </div>
                </div>
              </div>

              <!-- Set Tracking Circles (StrongLifts style) -->
              <div class="set-circles">
                @for (setIndex of getExerciseSets(exercise); track setIndex) {
                  <div class="set-circle"
                       [class.completed]="isSetCompleted(exercise, setIndex)"
                       [class.current]="isCurrentSet(exerciseIndex, setIndex)">
                    {{ setIndex + 1 }}
                  </div>
                }
              </div>

              <!-- Current Set Input (only show for current exercise) -->
              @if (currentExerciseIndex() === exerciseIndex && !isRestPeriod()) {
                <div class="set-input-section">
                  <div class="input-row">
                    @if (exercise.reps || currentSet().reps !== undefined) {
                      <div class="form-group">
                        <label class="label">Reps</label>
                        <input class="custom-input" type="number" [(ngModel)]="currentSet().reps" min="1" placeholder="0">
                      </div>
                    }

                    @if (exercise.weight || currentSet().weight !== undefined) {
                      <div class="form-group">
                        <label class="label">Weight</label>
                        <div class="input-with-suffix">
                          <input class="custom-input" type="number" [(ngModel)]="currentSet().weight" min="0" step="5" placeholder="0">
                          <span class="input-suffix">lbs</span>
                        </div>
                      </div>
                    }

                    @if (exercise.duration || currentSet().duration !== undefined) {
                      <div class="form-group">
                        <label class="label">Duration</label>
                        <div class="input-with-suffix">
                          <input class="custom-input" type="number" [(ngModel)]="currentSet().duration" min="1" placeholder="0">
                          <span class="input-suffix">sec</span>
                        </div>
                      </div>
                    }
                  </div>

                  @if (exercise.notes) {
                    <div class="exercise-notes">
                      <app-svg-icon name="info" size="md" color="primary"></app-svg-icon>
                      <span>{{ exercise.notes }}</span>
                    </div>
                  }

                  <button class="btn btn-primary complete-set-btn" (click)="completeSet()">
                    <app-svg-icon name="check" size="md"></app-svg-icon>
                    Complete Set
                  </button>
                </div>
              }
            </div>
          }
        </div>
      }

      <!-- Rest Timer Overlay (StrongLifts style) -->
      @if (isRestPeriod()) {
        <div class="rest-timer-overlay">
          <app-rest-timer
            [restDuration]="restTimeRemaining()"
            [autoStart]="true"
            (timerComplete)="onRestTimerComplete()"
            (timerDismissed)="onRestTimerDismissed()">
          </app-rest-timer>
        </div>
      }

      <!-- Bottom Controls -->
      <div class="bottom-controls">
        @if (isPaused()) {
          <button class="btn btn-icon btn-primary fab" (click)="resumeWorkoutFromPause()" title="Resume workout">
            <app-svg-icon name="play" size="lg"></app-svg-icon>
          </button>
        } @else {
          <button class="btn btn-icon fab pause-btn" (click)="pauseWorkout()" title="Pause workout">
            <app-svg-icon name="pause" size="lg"></app-svg-icon>
          </button>
        }

        <button class="btn btn-icon btn-danger fab" (click)="finishWorkout()" title="Stop workout">
          <app-svg-icon name="stop" size="lg"></app-svg-icon>
        </button>
      </div>
    </div>
  }

  <!-- Workout Complete State -->
  @if (isWorkoutComplete()) {
    <div class="workout-complete">
      <div class="complete-content">
        <div class="complete-icon">
          <app-svg-icon name="check" size="xl" color="success"></app-svg-icon>
        </div>
        <h2>Workout Complete!</h2>
        <div class="completion-stats">
          <div class="stat">
            <span class="stat-label">Duration</span>
            <span class="stat-value">{{ formatTime(elapsedTime()) }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Sets Completed</span>
            <span class="stat-value">{{ completedSets() }}</span>
          </div>
        </div>
        <button class="btn btn-primary" (click)="finishWorkout()">
          <app-svg-icon name="check" size="md"></app-svg-icon>
          Finish Workout
        </button>
      </div>
    </div>
  }
</div>
